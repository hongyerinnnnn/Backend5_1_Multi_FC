<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MULTI FC - 아이디/비밀번호 찾기</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<header class="quick-menu">
    <div class="logo"><a href="/">MULTI FC</a></div>
    <div class="header-icons">
        <button id="profile-menu-toggle" class="profile-icon" style="position: relative; display: none;">
            <i class="fas fa-user-circle"></i>
            <span id="notification-badge" class="notification-badge"></span>
        </button>
        <div id="profile-menu" class="user-menu">
            <div class="user-info"> <strong><span id="user-menu-username">사용자</span>님</strong> <p>환영합니다!</p> </div>
            <ul>
                <li><a href="/notifications" id="nav-notifications-link"><i class="fas fa-bell"></i> 알림 목록</a></li>
                <li><a href="/mypage"><i class="fas fa-user"></i> 마이페이지</a></li>
                <li><a href="/profile/edit"><i class="fas fa-user-edit"></i> 프로필 수정</a></li>
                <li><a href="#" id="logout-button"><i class="fas fa-sign-out-alt"></i> 로그아웃</a></li>
            </ul>
        </div>
        <button id="menu-toggle" class="menu-toggle-btn"><i class="fas fa-bars"></i></button>
    </div>
    <nav id="main-menu" class="main-nav">
        <ul>
            <li><a href="/"><i class="fas fa-home"></i> 메인 (Home)</a></li>
            <li><a href="/fields"><i class="fas fa-search"></i> 구장검색</a></li>
            <li><a href="/community"><i class="fas fa-users"></i> 커뮤니티</a></li>
            <li><a href="/chat"><i class="fas fa-comments"></i> 실시간채팅</a></li>

            <li><a href="/login" id="nav-login-link"><i class="fas fa-sign-in-alt"></i> 로그인</a></li>
            <li style="display:none;"><a href="#" id="nav-logout-link"><i class="fas fa-sign-out-alt"></i> 로그아웃</a></li>
        </ul>
    </nav>
</header>

<main class="login-page-main">
    <div class="main-wrapper">
        <div class="main-section">
            <div class="login-container">
                <h1 class="title-login">Find Account</h1>

                <p id="feedback-message" class="info-message" style="display:none; color: green; margin-bottom: 15px;">Message here.</p>
                <p id="error-message" class="error-message" style="display:none; margin-bottom: 15px;">Error message here.</p>

                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="find-id">아이디 찾기</button>
                    <button class="tab-btn" data-tab="find-pw">비밀번호 찾기</button>
                </div>

                <div id="find-id" class="tab-content active">

                    <form id="find-id-form">
                        <p style="font-size: 15px; color: #555; margin-bottom: 15px;">가입 시 사용한 이름과 이메일을 입력하세요.</p>
                        <div class="input-group">
                            <label for="find-id-name">이름</label>
                            <input type="text" id="find-id-name" name="name" placeholder="가입 시 등록한 이름" required>
                        </div>
                        <div class="input-group">
                            <label for="find-id-email">이메일</label>
                            <input type="email" id="find-id-email" name="email" placeholder="가입 시 등록한 이메일" required>
                        </div>
                        <button type="submit" class="login-button" style="margin-top: 20px;">인증번호 받기</button>
                    </form>

                    <form id="verify-id-form" style="display: none;">
                        <p style="font-size: 15px; color: #555; margin-bottom: 15px;">이메일로 발송된 6자리 인증번호를 입력하세요.</p>
                        <div class="input-group">
                            <label for="find-id-code">인증번호</label>
                            <input type="text" id="find-id-code" name="code" placeholder="인증번호 6자리" required maxlength="6">
                        </div>
                        <button type="submit" class="login-button" style="margin-top: 20px;">아이디 확인</button>
                    </form>

                    <div id="find-id-result" style="display: none; text-align: center; margin-top: 30px;">
                        <p style="font-size: 16px; color: #555;">회원님의 아이디입니다.</p>
                        <h3 id="found-id-text" style="font-size: 22px; color: #6c5ce7; margin: 10px 0 25px 0; font-weight: 700;"></h3>
                        <a href="/login" class="login-button" style="text-decoration: none; padding: 14px;">로그인하기</a>
                    </div>
                </div>

                <div id="find-pw" class="tab-content">

                    <form id="request-reset-form">
                        <p style="font-size: 15px; color: #555; margin-bottom: 15px;">아이디와 이메일을 입력하세요.</p>
                        <div class="input-group">
                            <label for="reset-pw-username">아이디 (User name)</label>
                            <input type="text" id="reset-pw-username" name="username" placeholder="아이디" required>
                        </div>
                        <div class="input-group">
                            <label for="reset-pw-email">이메일</label>
                            <input type="email" id="reset-pw-email" name="email" placeholder="가입 시 등록한 이메일" required>
                        </div>
                        <button type="submit" class="login-button" style="margin-top: 20px;">인증번호 받기</button>
                    </form>

                    <form id="verify-pw-form" style="display: none;">
                        <p style="font-size: 15px; color: #555; margin-bottom: 15px;">이메일로 발송된 6자리 인증번호를 입력하세요.</p>
                        <div class="input-group">
                            <label for="reset-pw-code">인증번호</label>
                            <input type="text" id="reset-pw-code" name="code" placeholder="인증번호 6자리" required maxlength="6">
                        </div>
                        <button type="submit" class="login-button" style="margin-top: 20px;">인증 확인</button>
                    </form>

                    <form id="reset-password-form" style="display: none;">
                        <p style="font-size: 15px; color: #555; margin-bottom: 15px;">인증이 완료되었습니다. 새 비밀번호를 설정하세요.</p>
                        <div class="input-group">
                            <label for="new-password">새 비밀번호</label>
                            <div class="password-wrapper">
                                <input type="password" id="new-password" name="newPassword" placeholder="8자 이상, 영문/숫자/특수문자 조합" required pattern="^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$">
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="confirm-new-password">새 비밀번호 확인</label>
                            <div class="password-wrapper">
                                <input type="password" id="confirm-new-password" name="confirmNewPassword" placeholder="********" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                        </div>
                        <button type="submit" class="login-button" style="margin-top: 20px;">비밀번호 변경</button>
                    </form>
                </div>

                <div class="back-to-login">
                    <a href="/login">&larr; 로그인 페이지로 돌아가기</a>
                </div>
            </div>
        </div>
        <div class="background-image-section" id="forgot-pw-background"></div>
    </div>
</main>

<script>
    // --- (★공통★) 메뉴 토글 및 로그아웃 로직 (forgot-password.html에 맞게 수정 및 통합) ---
    const menuToggle = document.getElementById('menu-toggle');
    const mainMenu = document.getElementById('main-menu');
    const profileMenuToggle = document.getElementById('profile-menu-toggle');
    const profileMenu = document.getElementById('profile-menu');
    const logoutButton = document.getElementById('logout-button');
    const navNotificationsLink = document.getElementById('nav-notifications-link');

    const navLoginLink = document.getElementById('nav-login-link');
    const navLogoutLink = document.getElementById('nav-logout-link');

    if (menuToggle) {
        menuToggle.addEventListener('click', () => {
            mainMenu.classList.toggle('show');
            if (profileMenu) profileMenu.classList.remove('show');
        });
    }

    if (profileMenuToggle) {
        profileMenuToggle.addEventListener('click', () => {
            profileMenu.classList.toggle('show');
            if (mainMenu) mainMenu.classList.remove('show');
        });
    }

    document.addEventListener('click', (event) => {
        const isClickInsideHeader = document.querySelector('header').contains(event.target);
        if (!isClickInsideHeader) {
            mainMenu.classList.remove('show');
            if (profileMenu) profileMenu.classList.remove('show');
        }
    });

    // 프로필 메뉴 내 로그아웃 버튼
    if (logoutButton) {
        logoutButton.addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('accessToken');
            localStorage.removeItem('hasReadReviews');
            localStorage.removeItem('hasReadSchedules');
            window.location.href = '/login';
        });
    }
    // 햄버거 메뉴의 로그아웃 버튼
    if (navLogoutLink) {
        navLogoutLink.addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('accessToken');
            localStorage.removeItem('hasReadReviews');
            localStorage.removeItem('hasReadSchedules');
            window.location.href = '/login';
        });
    }

    if (navNotificationsLink) {
        navNotificationsLink.addEventListener('click', (e) => {
            localStorage.setItem('hasReadReviews', 'true');
            localStorage.setItem('hasReadSchedules', 'true');
            window.location.href = '/notifications';
        });
    }

    // (★페이지별★) 로그인 상태 확인 및 리다이렉션 및 메뉴 표시 제어
    document.addEventListener('DOMContentLoaded', () => {
        const accessToken = localStorage.getItem('accessToken');

        if (accessToken) {
            // 이미 로그인했으면 메인으로 이동
            window.location.href = '/';
        } else {
            // [비회원일 때]
            if (profileMenuToggle) profileMenuToggle.style.display = 'none';
            if (navLoginLink) navLoginLink.parentElement.style.display = 'list-item';
            if (navLogoutLink) navLogoutLink.parentElement.style.display = 'none';
        }
    });
    // --- (★공통★) 메뉴 토글 로직 끝 ---


    // --- (기존 코드) 아이디/비밀번호 찾기 로직 유지 ---
    const feedbackMsg = document.getElementById('feedback-message');
    const errorMsg = document.getElementById('error-message');
    function clearMessages() {
        feedbackMsg.style.display = 'none';
        errorMsg.style.display = 'none';
    }
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTab = button.getAttribute('data-tab');
            clearMessages();
            document.getElementById('find-id-form').style.display = 'block';
            document.getElementById('verify-id-form').style.display = 'none';
            document.getElementById('find-id-result').style.display = 'none';
            document.getElementById('request-reset-form').style.display = 'block';
            document.getElementById('verify-pw-form').style.display = 'none';
            document.getElementById('reset-password-form').style.display = 'none';
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            button.classList.add('active');
            document.getElementById(targetTab).classList.add('active');
        });
    });
    const findIdForm = document.getElementById('find-id-form');
    const verifyIdForm = document.getElementById('verify-id-form');
    const findIdResult = document.getElementById('find-id-result');
    findIdForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        clearMessages();
        const name = document.getElementById('find-id-name').value.trim();
        const email = document.getElementById('find-id-email').value.trim();
        if (!name || !email) {
            errorMsg.textContent = '❌ 이름과 이메일을 모두 입력해주세요.';
            errorMsg.style.display = 'block';
            return;
        }
        try {
            await new Promise(resolve => setTimeout(resolve, 500));
            const success = true;
            if (success) {
                feedbackMsg.textContent = '✅ 인증번호가 이메일로 발송되었습니다.';
                feedbackMsg.style.display = 'block';
                findIdForm.style.display = 'none';
                verifyIdForm.style.display = 'block';
            } else {
                errorMsg.textContent = '❌ 일치하는 사용자 정보를 찾을 수 없습니다.';
                errorMsg.style.display = 'block';
            }
        } catch (error) {
            errorMsg.textContent = '❌ 요청 중 오류가 발생했습니다.';
            errorMsg.style.display = 'block';
        }
    });
    verifyIdForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        clearMessages();
        const code = document.getElementById('find-id-code').value.trim();
        if (code !== '123456') {
            errorMsg.textContent = '❌ 인증번호가 올바르지 않습니다.';
            errorMsg.style.display = 'block';
            return;
        }
        try {
            await new Promise(resolve => setTimeout(resolve, 500));
            const foundId = "futsal_user";
            const maskedId = foundId.substring(0, 5) + '*****';
            document.getElementById('found-id-text').textContent = maskedId;
            verifyIdForm.style.display = 'none';
            findIdResult.style.display = 'block';
        } catch (error) {
            errorMsg.textContent = '❌ 인증 처리 중 오류가 발생했습니다.';
            errorMsg.style.display = 'block';
        }
    });
    const requestResetForm = document.getElementById('request-reset-form');
    const verifyPwForm = document.getElementById('verify-pw-form');
    const resetPasswordForm = document.getElementById('reset-password-form');
    requestResetForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        clearMessages();
        const username = document.getElementById('reset-pw-username').value.trim();
        const email = document.getElementById('reset-pw-email').value.trim();
        if (!username || !email) {
            errorMsg.textContent = '❌ 아이디와 이메일을 모두 입력해주세요.';
            errorMsg.style.display = 'block';
            return;
        }
        try {
            await new Promise(resolve => setTimeout(resolve, 500));
            const success = true;
            if (success) {
                feedbackMsg.textContent = '✅ 인증번호가 이메일로 발송되었습니다.';
                feedbackMsg.style.display = 'block';
                requestResetForm.style.display = 'none';
                verifyPwForm.style.display = 'block';
            } else {
                errorMsg.textContent = '❌ 일치하는 사용자 정보를 찾을 수 없습니다.';
                errorMsg.style.display = 'block';
            }
        } catch (error) {
            errorMsg.textContent = '❌ 요청 중 오류가 발생했습니다.';
            errorMsg.style.display = 'block';
        }
    });
    verifyPwForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        clearMessages();
        const code = document.getElementById('reset-pw-code').value.trim();
        if (code !== '123456') {
            errorMsg.textContent = '❌ 인증번호가 올바르지 않습니다.';
            errorMsg.style.display = 'block';
            return;
        }
        feedbackMsg.textContent = '✅ 인증이 완료되었습니다. 새 비밀번호를 설정하세요.';
        feedbackMsg.style.display = 'block';
        verifyPwForm.style.display = 'none';
        resetPasswordForm.style.display = 'block';
    });
    resetPasswordForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        clearMessages();
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-new-password').value;
        const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
        if (newPassword !== confirmPassword) {
            errorMsg.textContent = '❌ 새 비밀번호가 일치하지 않습니다.';
            errorMsg.style.display = 'block';
            return;
        }
        if (!passwordPattern.test(newPassword)) {
            errorMsg.textContent = '❌ 비밀번호는 8자 이상이며, 영문, 숫자, 특수문자를 포함해야 합니다.';
            errorMsg.style.display = 'block';
            return;
        }
        try {
            await new Promise(resolve => setTimeout(resolve, 500));
            alert("비밀번호가 성공적으로 변경되었습니다. 로그인 페이지로 이동합니다.");
            window.location.href = '/login';
        } catch (error) {
            errorMsg.textContent = '❌ 비밀번호 변경 중 오류가 발생했습니다.';
            errorMsg.style.display = 'block';
        }
    });

    // --- (기존 코드) 비밀번호 토글 로직 유지 ---
    document.querySelectorAll('.toggle-password').forEach(icon => {
        icon.addEventListener('click', function() {
            const passwordInput = this.parentElement.querySelector('input');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });
    });
</script>

</body>
</html>