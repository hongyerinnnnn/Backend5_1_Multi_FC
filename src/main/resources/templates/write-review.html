<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MULTI FC - 경기 후기 작성</title>

</head>
<body>

<main class="login-page-main">
    <div class="main-wrapper">
        <div class="login-section">
            <div class="login-container">

                <h1 class="title-login">경기 후기 작성</h1>
                <form id="review-form">

                    <div class="input-group">
                        <label>후기 작성 대상 경기</label>
                        <input type="text" id="match-info" value="2025-10-30 (목) 19:00 - 서울 강남 풋살장" disabled
                               style="background: #eee; cursor: not-allowed; width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px; ">
                        <input type="hidden" id="match-id" name="matchId" value="12345">
                        <input type="hidden" id="stadium-id" name="stadiumId" value="101">
                    </div>

                    <div class="input-group" style="margin-top: 20px;">
                        <label for="review-rating">평점 (1~5)</label>
                        <input type="number" id="review-rating" name="rating" min="1" max="5" required
                               placeholder="구장 평점을 1점에서 5점까지 입력해주세요."
                               style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px; background: #f7f7f7;">
                    </div>

                    <div class="input-group" style="margin-top: 30px;">
                        <label for="review-content">경기 한줄평을 작성해 주세요.</label>
                        <textarea id="review-content" name="content" rows="5"
                                  placeholder="경기 소감이나 구장 피드백 등을 남겨주세요."
                                  required
                                  style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px; background: #f7f7f7; font-family: inherit; resize: vertical;"></textarea>
                    </div>

                    <button type="submit" class="login-button" style="margin-top: 25px;">후기 등록</button>
                </form>
            </div>
        </div>
        <div class="background-image-section">
        </div>
    </div>
</main>

<script>
    // ... 기존 메뉴 토글 및 인증 로직 유지 ...

    // --- (★페이지별★) 후기 등록 로직 (수정됨) ---
    const reviewForm = document.getElementById('review-form');
    const successMsg = document.getElementById('review-success-message');
    const errorMsg = document.getElementById('review-error-message');

    reviewForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        successMsg.style.display = 'none';
        errorMsg.style.display = 'none';

        const content = document.getElementById('review-content').value.trim();
        const rating = document.getElementById('review-rating').value;
        const stadiumId = document.getElementById('stadium-id').value;
        const currentUserId = localStorage.getItem('userId');

        if (!currentUserId) {
            alert("로그인 정보가 없습니다. 다시 로그인해주세요.");
            return window.location.href = '/login';
        }

        if (content === '' || !rating || !stadiumId) {
            errorMsg.textContent = '❌ 평점, 내용, 구장 정보가 모두 필요합니다.';
            errorMsg.style.display = 'block';
            return;
        }

        const reviewData = {
            stadiumId: Number(stadiumId),
            userId: Number(currentUserId),
            rating: Number(rating),
            content: content
        };

        try {
            const response = await fetch('/api/reviews', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    // 실제 인증 토큰이 필요하다면 여기에 'Authorization': `Bearer ${localStorage.getItem('accessToken')}` 추가
                },
                body: JSON.stringify(reviewData)
            });

            if (response.ok) {
                // 후기 작성 성공 처리
                localStorage.setItem('hasReadReviews', 'true');

                successMsg.textContent = '✅ 후기가 성공적으로 등록되었습니다. 메인 페이지로 이동합니다.';
                successMsg.style.display = 'block';

                setTimeout(() => {
                    window.location.href = '/';
                }, 2000);
            } else {
                const errorText = await response.text();
                // 서버에서 보낸 에러 메시지를 표시
                alert(`후기 등록 실패: ${errorText}`);
                errorMsg.textContent = `❌ 후기 등록 중 오류가 발생했습니다. (${response.status})`;
                errorMsg.style.display = 'block';
            }

        } catch (error) {
            console.error('API 통신 실패', error);
            errorMsg.textContent = '❌ 서버 통신 중 예상치 못한 오류가 발생했습니다.';
            errorMsg.style.display = 'block';
        }
    });
</script>
</body>
</html>