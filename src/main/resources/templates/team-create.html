<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MULTI FC - 새 팀 생성</title>

  <link rel="stylesheet" th:href="@{/css/style.css}">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    .team-main {
      padding: 100px 40px 40px 40px;
      background-color: #f7f7f7;
      min-height: 100vh;
    }
    .team-container {
      max-width: 650px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .team-title {
      font-size: 28px;
      font-weight: 700;
      color: #4a90e2; /* 초대 강조색 */
      margin-bottom: 25px;
      border-bottom: 2px solid #ddd;
      padding-bottom: 10px;
      text-align: center;
    }
    .input-group {
      margin-bottom: 20px;
    }
    .input-group.with-button {
      display: flex;
      align-items: flex-end;
      gap: 10px;
      margin-bottom: 20px;
    }
    .input-group.with-button .input-wrapper {
      flex-grow: 1;
    }
    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
      font-size: 15px;
    }
    .input-group input[type="text"],
    .input-group input[type="number"],
    .input-group input[type="file"] {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
      transition: border-color 0.2s;
    }
    .input-group input[type="text"]:focus,
    .input-group input[type="number"]:focus,
    .input-group input[type="file"]:focus {
      border-color: #6c5ce7;
      outline: none;
    }
    .check-duplicate-btn {
      padding: 12px 18px;
      font-size: 14px;
      font-weight: 600;
      color: #6c5ce7;
      background: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      white-space: nowrap;
      transition: background-color 0.2s, border-color 0.2s;
    }
    .check-duplicate-btn:hover:not(:disabled) {
      background-color: #e0e0e0;
      border-color: #6c5ce7;
    }
    .check-duplicate-btn.success {
      background-color: #2ecc71;
      color: white;
      border-color: #2ecc71;
    }
    .check-duplicate-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .login-button.team-create-btn {
      background: linear-gradient(135deg, #6c5ce7, #8e44ad);
      border: none;
      color: white;
      padding: 15px 0;
      font-size: 18px;
      font-weight: 700;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 25px;
    }
    .login-button.team-create-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
    }
    .login-button.team-create-btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }

    .btn-cancel {
      background-color: #f0f0f0;
      color: #555;
      border: 1px solid #ddd;
      padding: 15px 0;
      font-size: 18px;
      font-weight: 700;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-top: 15px;
    }
    .btn-cancel:hover {
      background-color: #e0e0e0;
    }

    .info-message, .error-message {
      font-size: 14px;
      margin-top: -10px;
      margin-bottom: 15px;
      padding-left: 5px;
    }
    .info-message { color: #2ecc71; }
    .error-message { color: #e74c3c; }
  </style>

</head>
<body>

<header class="quick-menu">
</header>

<main class="team-main">
  <div class="team-container">
    <h1 class="team-title"><i class="fas fa-users"></i> 새 팀 생성</h1>

    <p id="team-message" class="error-message" style="display:none; text-align: center;"></p>

    <form id="team-create-form">

      <div class="input-group with-button">
        <div class="input-wrapper">
          <label for="team-name">팀 이름</label>
          <input type="text" id="team-name" name="teamName" placeholder="팀 이름을 입력하세요" required>
        </div>
        <button type="button" class="check-duplicate-btn" id="check-teamname-btn">중복확인</button>
      </div>
      <p id="teamname-message" class="info-message" style="display:none;"></p>

      <div class="input-group">
        <label for="motto">팀 슬로건 (선택)</label>
        <input type="text" id="motto" name="motto" placeholder="팀을 소개하는 멋진 슬로건">
      </div>

      <div class="input-group">
        <label for="max-size">최대 팀 인원</label>
        <input type="number" id="max-size" name="maxSize" placeholder="최소 5명" value="10" min="5" required>
      </div>

      <div class="input-group">
        <label for="logo-image">팀 로고 이미지 (선택)</label>
        <input type="file" id="logo-image" name="logoImage" accept="image/*">
      </div>

      <button type="submit" id="submit-team-btn" class="login-button team-create-btn" disabled>
        팀 생성 (이름 확인 필요)
      </button>

      <button type="button" class="btn-cancel" onclick="history.back()">
        취소하고 돌아가기
      </button>
    </form>
  </div>
</main>

<script>
  // --- (★공통★) 메뉴 토글 및 인증 로직 (생략) ---

  document.addEventListener('DOMContentLoaded', () => {
    const accessToken = localStorage.getItem('accessToken');
    if (!accessToken) {
      alert("로그인이 필요한 페이지입니다.");
      window.location.href = '/login';
      return;
    }

    document.getElementById('submit-team-btn').disabled = true;
  });

  let isTeamnameChecked = false;

  // ⭐⭐ 팀 이름 중복 확인 로직 ⭐⭐
  document.getElementById('check-teamname-btn').addEventListener('click', async () => {
    const teamNameInput = document.getElementById('team-name');
    const message = document.getElementById('teamname-message');
    const btn = document.getElementById('check-teamname-btn');
    const submitBtn = document.getElementById('submit-team-btn');

    const teamName = teamNameInput.value.trim();

    if (!teamName) {
      message.className = 'error-message';
      message.textContent = '❌ 팀 이름을 입력해주세요.';
      message.style.display = 'block';
      isTeamnameChecked = false;
      submitBtn.disabled = true;
      return;
    }

    btn.textContent = '확인 중...';
    btn.disabled = true;

    await new Promise(r => setTimeout(r, 800));

    // 더미 중복 확인
    const isDuplicate = (teamName.toLowerCase() === 'fc 매칭 히어로즈'.toLowerCase());

    if (isDuplicate) {
      message.className = 'error-message';
      message.textContent = `❌ 이미 존재하는 팀 이름입니다.`;
      isTeamnameChecked = false;
      btn.disabled = false;
      btn.textContent = '중복확인';
      submitBtn.disabled = true;
      btn.classList.remove('success'); // 실패 시 success 제거
    } else {
      message.className = 'info-message';
      message.textContent = `✅ 사용 가능한 팀 이름입니다.`;
      isTeamnameChecked = true;
      btn.classList.add('success');
      btn.textContent = '확인 완료';
      submitBtn.disabled = false;
      submitBtn.textContent = '팀 생성';
    }
    message.style.display = 'block';
  });

  // 팀 이름 입력 변경 시 상태 초기화
  document.getElementById('team-name').addEventListener('input', () => {
    isTeamnameChecked = false;
    document.getElementById('check-teamname-btn').disabled = false;
    document.getElementById('check-teamname-btn').textContent = '중복확인';
    document.getElementById('check-teamname-btn').classList.remove('success');
    document.getElementById('submit-team-btn').disabled = true;
    document.getElementById('submit-team-btn').textContent = '팀 생성 (이름 확인 필요)';
    document.getElementById('teamname-message').style.display = 'none';
  });


  // ⭐⭐ 폼 제출 로직 ⭐⭐
  document.getElementById('team-create-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const msg = document.getElementById('team-message');

    if (!isTeamnameChecked) {
      msg.className = 'error-message';
      msg.textContent = '❌ 팀 이름 중복 확인을 완료해주세요.';
      msg.style.display = 'block';
      return;
    }

    // 실제로는 FormData를 백엔드 API (POST /api/teams/create)로 전송
    console.log("팀 생성 요청 시뮬레이션...");

    msg.className = 'info-message';
    msg.textContent = '✅ 팀이 성공적으로 생성되었습니다. 팀 관리 페이지로 이동합니다.';
    msg.style.display = 'block';

    setTimeout(() => {
      // 마이페이지의 '친구/팀원 관리' 탭으로 리다이렉트
      window.location.href = '/friends?tab=team';
    }, 1500);
  });
</script>
