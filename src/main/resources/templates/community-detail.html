<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'게시글 상세 (' + ${postId} + ') - FUTSAL MATCH'">FUTSAL MATCH - 게시글 상세</title>

    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        .community-main {
            padding: 100px 40px 40px 40px;
            background-color: #f7f7f7;
            min-height: 100vh;
        }
        .board-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .detail-header {
            border-bottom: 1px solid #ddd;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .detail-header h1 {
            font-size: 26px;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .detail-meta {
            font-size: 14px;
            color: #999;
        }
        .detail-meta span:not(:last-child)::after {
            content: " | ";
            color: #ccc;
        }

        .detail-content {
            min-height: 200px;
            padding: 20px 0;
            line-height: 1.6;
            font-size: 16px;
            color: #333;
            border-bottom: 1px solid #eee;
        }

        /* 좋아요 및 액션 버튼 그룹 */
        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        #like-button {
            padding: 8px 15px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 15px;
        }
        #like-button:hover {
            background-color: #c0392b;
        }
        .detail-controls button, .detail-controls a {
            padding: 8px 15px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            margin-left: 5px;
        }

        /* ⭐⭐ 댓글 섹션 스타일 (ERD: Comment 반영) ⭐⭐ */
        .comments-section {
            margin-top: 30px;
        }
        .comment-item {
            border-bottom: 1px dotted #ddd;
            padding: 15px 0;
            font-size: 15px;
        }
        .comment-meta {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #999;
            margin-bottom: 5px;
        }
        .comment-writer {
            font-weight: 700;
            color: #6c5ce7;
        }
        .comment-content {
            color: #333;
            line-height: 1.5;
        }
        .comment-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            margin-bottom: 10px;
        }
        .comment-form button {
            float: right;
            padding: 8px 15px;
            background-color: #6c5ce7;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        /* ⭐⭐ 댓글 섹션 스타일 끝 ⭐⭐ */
    </style>
</head>
<body>

<header class="quick-menu">
</header>

<main class="community-main">
    <div class="board-container">

        <div class="detail-header">
            <h1 id="post-title"></h1>
            <div class="detail-meta">
                <span id="detail-writer"></span>
                <span id="detail-date"></span>
                <span id="detail-views"></span>
                <span id="detail-comments"></span>
            </div>
        </div>

        <div class="detail-content" id="post-content">
            <!-- 게시글 내용이 여기에 로드됩니다 -->
        </div>

        <div class="post-actions">
            <button id="like-button">
                <i class="fas fa-thumbs-up"></i> 좋아요 (<span id="like-count">0</span>)
            </button>

            <div class="detail-controls">
                <a href="/community" class="btn-list">목록으로</a>
                <button class="btn-edit" id="btn-edit-post" style="display:none;">수정</button>
                <button class="btn-delete" id="btn-delete-post" style="display:none;">삭제</button>
            </div>
        </div>

        <!-- ⭐⭐ 댓글 섹션 (ERD: Comment 반영) ⭐⭐ -->
        <div class="comments-section">
            <h3 style="font-size: 20px; color: #2c3e50; margin-bottom: 15px;">댓글 (<span id="comment-count">0</span>)</h3>

            <!-- 댓글 작성 폼 -->
            <div class="comment-form">
                <textarea id="comment-input" placeholder="댓글을 입력하세요..." required></textarea>
                <button onclick="submitComment()">등록</button>
            </div>

            <!-- 댓글 목록 -->
            <div id="comments-list">
                <!-- JS 로직으로 댓글이 여기에 삽입됩니다 -->
            </div>
        </div>
        <!-- ⭐⭐ 댓글 섹션 끝 ⭐⭐ -->

    </div>
</main>

<script>
    // --- 더미 데이터 ---
    const POST_DATA = {
        postId: 10,
        title: '[필독] 공지사항 및 매너 점수 안내',
        content: '안녕하세요. FUTSAL MATCH입니다. 원활하고 공정한 경기 매칭을 위해 매너 점수(Manner Score) 시스템을 다음과 같이 개편합니다. 모든 사용자는 변경된 규정을 숙지하여 주시기 바랍니다. - 변경 사항 요약 - 1. 경기 종료 후 의무적으로 팀원 평가를 진행해야 합니다. 2. 평가 미참여시 다음 경기 매칭에 불이익이 발생할 수 있습니다.',
        writer: '관리자',
        date: '2025-10-25',
        likeCount: 50,
        viewCount: 1200,
        comments: [
            { id: 1, writer: 'UserA', date: '2025-10-25', content: '운영진님, 매너 시스템 도입 찬성합니다! 기대돼요.' },
            { id: 2, writer: 'UserB', date: '2025-10-26', content: '좋은 취지인데, 평가가 너무 주관적이지 않도록 관리 부탁드립니다.' }
        ]
    };

    const CURRENT_USER = 'MyUser123'; // 현재 로그인된 사용자 ID 가정

    // --- DOM 로드 및 초기화 ---
    document.addEventListener('DOMContentLoaded', () => {
        // (인증/메뉴 로직은 공통 JS에 포함되어 있다고 가정)

        loadPostDetail(POST_DATA);
        document.getElementById('like-button').addEventListener('click', handleLike);

        // 수정/삭제 버튼 권한 체크 (현재 유저가 작성자인 경우)
        if (CURRENT_USER === POST_DATA.writer) {
            document.getElementById('btn-edit-post').style.display = 'inline-block';
            document.getElementById('btn-delete-post').style.display = 'inline-block';
            document.getElementById('btn-delete-post').onclick = handleDeletePost;
            document.getElementById('btn-edit-post').onclick = handleEditPost;
        }
    });

    function loadPostDetail(data) {
        // 게시글 정보 로드 (Board 엔티티 반영)
        document.getElementById('post-title').textContent = data.title;
        document.getElementById('detail-writer').textContent = `작성자: ${data.writer}`;
        document.getElementById('detail-date').textContent = data.date;
        document.getElementById('detail-views').textContent = `조회: ${data.viewCount}`;
        document.getElementById('detail-comments').textContent = `댓글: ${data.comments.length}`;
        document.getElementById('post-content').innerHTML = data.content.replace(/\n/g, '<br>');
        document.getElementById('like-count').textContent = data.likeCount;
        document.getElementById('comment-count').textContent = data.comments.length;

        renderComments(data.comments);
    }

    // ⭐⭐ 댓글 목록 렌더링 함수 (Comment 엔티티 반영) ⭐⭐
    function renderComments(comments) {
        const commentsList = document.getElementById('comments-list');
        commentsList.innerHTML = '';

        if (comments.length === 0) {
            commentsList.innerHTML = '<p style="color: #999; padding: 10px 0; text-align: center;">아직 댓글이 없습니다. 첫 댓글을 남겨보세요!</p>';
            return;
        }

        comments.forEach(comment => {
            const item = document.createElement('div');
            item.className = 'comment-item';
            item.innerHTML = `
                <div class="comment-meta">
                    <span class="comment-writer">${comment.writer}</span>
                    <span>${comment.date}</span>
                </div>
                <div class="comment-content">${comment.content}</div>
            `;
            commentsList.appendChild(item);
        });
    }

    // ⭐⭐ 댓글 작성 로직 (Comment 엔티티 반영) ⭐⭐
    function submitComment() {
        const commentInput = document.getElementById('comment-input');
        const content = commentInput.value.trim();

        if (content.length === 0) {
            alert('댓글 내용을 입력해주세요.');
            return;
        }

        const newComment = {
            id: Date.now(), // 더미 ID
            writer: CURRENT_USER,
            date: new Date().toISOString().slice(0, 10),
            content: content
        };

        // ⭐ 백엔드 API 호출: POST /api/comments/new (Comment.content, Comment.board_id 등 전송)
        console.log("댓글 제출 시뮬레이션:", newComment);

        // UI 업데이트
        POST_DATA.comments.push(newComment);
        renderComments(POST_DATA.comments);
        commentInput.value = '';
        document.getElementById('comment-count').textContent = POST_DATA.comments.length;
        document.getElementById('detail-comments').textContent = `댓글: ${POST_DATA.comments.length}`;
    }

    // ⭐⭐ 좋아요 버튼 핸들러 (Board.like_count 반영) ⭐⭐
    let liked = false;
    function handleLike() {
        if (liked) {
            alert("이미 좋아요를 눌렀습니다.");
            return;
        }

        // ⭐ 백엔드 API 호출: POST /api/board/like/{postId}
        console.log(`게시글 ${POST_DATA.postId}에 좋아요 추가 시뮬레이션`);

        POST_DATA.likeCount += 1;
        document.getElementById('like-count').textContent = POST_DATA.likeCount;
        document.getElementById('like-button').style.backgroundColor = '#27ae60'; // 색상 변경
        document.getElementById('like-button').textContent = `✓ 좋아요 (${POST_DATA.likeCount})`;
        liked = true;
    }

    function handleDeletePost() {
        if (confirm(`정말로 게시글 [${POST_DATA.title}]을 삭제하시겠습니까?`)) {
            // ⭐ 백엔드 API 호출: DELETE /api/board/{postId}
            alert("게시글이 삭제되었습니다. 목록으로 돌아갑니다. (시뮬레이션)");
            location.href = '/community';
        }
    }

    function handleEditPost() {
        alert("게시글 수정 페이지로 이동합니다. (구현 필요)");
        // location.href = `/community/write?edit=${POST_DATA.postId}`;
    }
</script>
